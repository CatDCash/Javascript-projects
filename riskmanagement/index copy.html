<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Excel File Comparison</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.4/xlsx.full.min.js"></script>
</head>
<body>

<label for="userInput">Select a value:</label>
<select id="userInput">
  <option value="riesgo1">riesgo1</option>
  <option value="riesgo2">riesgo2</option>
  <!-- agregar escenarios aquí -->
</select>

<button onclick="compareExcel()">Compare</button>

<table id="resultTable" border="1">
  <!-- Tabla para mostrar los reusultados -->
</table>

<script>
function compareExcel() {
  // Para esta primera prueba, unicamente se selecciona un escenario
  var selectedValue = document.getElementById("userInput").value;
  
  // Leemos el excel. Por el momento solicita al usuario que lo provea
  var fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = '.xlsx, .xls';
  fileInput.onchange = function(e) {
    var file = e.target.files[0];
    var reader = new FileReader();
    
    reader.onload = function(e) {
      var data = new Uint8Array(e.target.result);
      var workbook = XLSX.read(data, {type: 'array'});
      
      // aqui se empieza a generar el objeto para coinsultar la info de excel
      var sheetName = workbook.SheetNames[0];
      var worksheet = workbook.Sheets[sheetName];
      
      // Convierte la worksheet a JSON object
      var excelData = XLSX.utils.sheet_to_json(worksheet);
      
      // Filtramos la información enbase a la seleccion del combobox
      var filteredData = excelData.filter(function(row) {
        return row.riesgo === selectedValue; // Este campo tiene quehacer match con la columna que se necesita buscar
      });
      
      // Generamos la tabla que se va a mostrar como resultado
      var tableHtml = '<tr><th>Control</th><th>Condicion</th><th>Descripcion</th><th>Mitigacion</th></tr>'; // 
      
      filteredData.forEach(function(row) {
        tableHtml += '<tr><td>' + row.control + '</td><td>' + row.riesgo +'</td><td>' + row.descripcion + '</td><td>' + row.mitigacion + '</td></tr>'; // 
      });
      
      // Display the result table
      document.getElementById("resultTable").innerHTML = tableHtml;
    };
    
    reader.readAsArrayBuffer(file);
  };
  
  fileInput.click(); // Trigger file input dialog
}
</script>

</body>
</html>
